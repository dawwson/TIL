# 클린 코드(Clean Code)

`#노개북` `#노마드코더` `#개발자북클럽`

- 작가 : 로버트 C. 마틴
- 출판사 : 인사이트

<br>

## Assignment #11

`2024.02.09`

### 🔖 8. 경계 ~ 9. 단위 테스트

#### 기억하고 싶은 내용

[ 8. 경계 : 소프트웨어 경계를 깔끔하게 처리하는 방법 ]

1. 경계 인터페이스를 이를 이용하는 클래스나 클래스 계열 밖으로 노출되지 않도록 한다.

   - 새로운 클래스로 경계를 감싸서 캡슐화
   - 공개 API의 파라미터나 반환값으로 사용하지 않기

2. "학습 테스트" 코드를 작성하여 외부 코드를 익힌다.

   - 외부 라이브러리의 사용법이 분명하지 않다거나, 사용하기 위해 방법을 익혀야 할 때 학습 테스트를 한다.
   - 간단한 테스트 케이스를 작성해 외부 라이브러리를 익히고 우리의 코드와 통합한다.
     - 실제 코드와 동일한 방식으로 인터페이스를 사용하는 테스트 케이스이다.
   - 학습 테스트는 패키지가 예상대로 도는지 검증한다.
   - 외부 라이브러리의 새 버전이 우리의 코드와 호환되지 않으면 학습 테스트를 통해 이 사실을 밝혀낼 수 있다.
   - JS 예시)

     ```js
     // add.js

     // 두 수를 더하는 함수
     function add(a, b) {
       return a + b;
     }

     module.exports = add;
     ```

     ```js
     const add = require("./add");

     // add 함수를 검증하는 테스트 케이스
     describe("add function", () => {
       test("adds 1 + 2 to equal 3", () => {
         expect(add(1, 2)).toBe(3);
       });

       test("adds -1 + 1 to equal 0", () => {
         expect(add(-1, 1)).toBe(0);
       });

       test("adds 0 + 0 to equal 0", () => {
         expect(add(0, 0)).toBe(0);
       });

       test("adds -1 + -1 to equal -2", () => {
         expect(add(-1, -1)).toBe(-2);
       });
     });
     ```

3. 아직 정의되지 않은 클라이언트와 연동하려면 필요한 인터페이스를 작성한다.

   - `Adapter 패턴` 사용하기

4. 결론

   - 경계에 위치하는 코드는 깔끔히 분리하고, 기대치를 정의하는 테스트 케이스를 작성한다.
   - 통제 불가능한 외부 패키지 대신 통제 가능한 우리 코드에 의존하는 편이 좋다.
   - 외부 패키지를 호출하는 코드를 가능한 줄여 경계를 관리한다.

<br>

[ 9. 단위 테스트 : 깨끗한 테스트 코드 ]

1. 테스트 코드는 왜 깨끗해야 하는가?

   - 테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 오래 걸린다.
   - 실패하는 테스트 케이스를 점점 더 통과시키기 어려워진다.
   - 테스트 케이스 유지보수 비용이 커지면 테스트 자체를 버리게 되고, 이는 곧 시스템의 결함율이 높아지는 것으로 이어진다.

2. 테스트가 제공하는 것 : 유연성, 유지보수성, 재사용성

   - 테스트 케이스가 있으면 변경이 쉬워진다.

3. 가독성을 높이자

   - `Build-Operate-Check` 패턴

     - Build : 테스트 자료를 만든다.
     - Operate : 테스트 자료를 조작한다.
     - Check : 조작한 결과가 올바른지 확인한다.

   - 테스트 코드는 실제 코드만큼 효율적일 필요는 없다.
     - 테스트 환경은 자원(메모리, CPU 등)이 제한적일 가능성이 낮다.
     - 효율성 보다는 가독성을 높이는 것에 좀 더 집중하면 좋다.

4. 테스트 함수는 개념 하나만 테스트 + 개념 당 assert 문 수롤 최소로 줄이자

   - assert는 테스트의 결론이다. 결론이 적을수록 코드를 이해하기 쉽다.
   - 잡다한 개념을 연속으로 테스트하는 긴 함수는 이해하기 어렵다. 쪼갠다!

5. 깨끗한 테스트의 규칙 : `F.I.R.S.T`
   - `F`ast
     - 테스트는 빨리 돌아야 한다.
   - `I`ndependent
     - 각 테스트는 서로 의존하면 안 된다.
     - 순서에 영향받지 않는다.
   - `R`epeatable
     - 테스트는 어떤 환경에서도 반복 가능해야 한다.
     - 네트워크가 연결되지 않아도 가능해야 한다.
   - `S`elf-Validating
     - 테스트는 성공 아니면 실패여야 한다.
     - 테스트 스스로 성공/실패를 가늠해야 한다. 결과 확인이 수작업이 되면 안 된다.
   - `T`imely
     - 테스트는 적시에 작성해야 한다.
     - 테스트가 불가능하도록 설계하지 않기 위해, 실제 코드를 구현하기 직전에 테스트를 구현한다.

#### 오늘 읽은 소감

- (이 경험을 Adapter 패턴을 적용한 사례라고 보긴 어렵겠지만...)과거에 회사에서 팀 프로젝트를 할 때, 새로운 화면을 구현해야 했다. 화면에서 새롭게 추가해야 하는 기능은 연결된 녹화 장비의 해상도를 가져와서 화면에 표시하는 것이었다. 이를 위해 로우 레벨에서 연결된 녹화 장비의 해상도 값을 받아서 전송해주는 모듈, 전송받은 데이터를 화면 단에서 사용할 수 있도록 적절한 형태로 변환해주는 모듈이 새롭게 필요해졌다. 세 개의 모듈이 연결되므로 두 개의 인터페이스가 필요했다. 당시 변환 모듈을 맡으셨던 개발자 분이 주도하셔서 다같이 모여 두 개의 인터페이스를 정의했다. 서로 어떻게 데이터를 주고 받을지 협의를 해두었기 때문에, 인터페이스에 따라 각자 개발만 하면 됐고 그 과정은 아주 순조로웠다. 만약 인터페이스를 정의하는 회의를 거치지 않았다면, 개발 진척도도 더디고 뒤에서 돌아가는 모듈에 의존하게 되어 개발 과정이 상당히 골치 아팠을 것이다. 그때 회의를 주도해주셨던 멋진 개발자 분에게 좋은 개발 경험을 쌓을 수 있는 경험을 접하게 해주셔서 감사드린다는 말씀을 뒤늦게라도 전하고 싶다.

- 작가는 TDD를 지속해서 권장하고 있지만, 실천하기가 어려운 것 같다. 시간에 쫓겨 허겁지겁 개발하다 보면 좋은 테스트란 무엇인가에 대해 생각해볼 기회조차 놓치게 되는 것 같다. 9장 내용을 통해 가독성 높은 테스트 케이스를 작성하는 것에 신경을 쓰면, 결과적으로는 개발 속도도 높일 수 있다는 것을 느끼게 되었다. 다만 테스트 API까지 개발하라는 것에는 동의하기 어렵다...💦 가독성을 높이기 위한 수단이라는 것은 이해하지만, 일단 테스트 프레임워크를 충분히 활용하고 Build-Operate-Check 패턴을 사용하는 것만으로도 충분하지 않나, 라는 생각이 든다. 물론 테스트 API 개발도 한 번 경험해봐야 정말 불필요한 건지 알 수 있겠다마는... 현재 생각으로는 그렇다!

#### 궁금한 내용 & 잘 이해되지 않는 내용

1. Adapter 패턴 [[참고]](https://yozm.wishket.com/magazine/detail/2077/)

   - 정의
     - 호환되지 않는 인터페이스를 연결하는 디자인 패턴
   - 주요 구성 요소
     - 타겟 : 클라이언트가 직접적으로 호출하는 인터페이스
     - 어댑티 : 아직 호환되지 않은 기존 클래스(또는 인터페이스)
     - 어댑터 : 타겟 인터페이스를 구현하여 클라이언트 요청을 어댑티로 전달하는 클래스
     - 클라이언트 : 특정 작업을 요청하는 클래스
   - 언제 필요한가?
     - 호환되지 않는 인터페이스를 가진 클래스들이 함께 작동해야 하는 경우
     - 이미 존재하는 클래스의 인터페이스가 요구 사항과 맞지 않는 경우
     - 기존 클래스에 원하는 인터페이스가 없는 경우

2. Template-Method 패턴 [[참고]](https://inpa.tistory.com/entry/GOF-%F0%9F%92%A0-%ED%85%9C%ED%94%8C%EB%A6%BF-%EB%A9%94%EC%86%8C%EB%93%9CTemplate-Method-%ED%8C%A8%ED%84%B4-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EB%B0%B0%EC%9B%8C%EB%B3%B4%EC%9E%90)
   - 정의
     - 여러 클래스에서 공통으로 사용하는 메서드를 템플릿화 하여 상위 클래스에서 정의하고, 하위 클래스마다 세부 동작 사항을 다르게 구현하는 디자인 패턴

#### 나의 최애 북틸

1. [[링크 1]](https://dongpark.notion.site/8-8e86f520f77c4391ac5589102ae7465d)

   - 책에서 사용한 표현을 그대로 사용하지 않고, 본인이 이해한 표현으로 바꿔서 정리해주신 점이 좋았습니다 👍

2. [[링크 2]](https://nomadcoders.co/community/thread/9287)

   - 읽은 부분의 핵심 내용을 단순한 예시를 통해 잘 정리해주셨습니다 😁

3. [[링크 3]](https://nomadcoders.co/community/thread/9267)

   - 자료구조와 객체의 차이를 예시를 통해 정리해주신 부분을 보고 저도 개념을 이해하는 데에 도움이 되었습니다! 💕
